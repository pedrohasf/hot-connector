# NEAR Connect

> Zero-dependency, secure, and lightweight wallet connector for the NEAR blockchain.

## Installation

```bash
yarn add @hot-labs/near-connect
```

Or via CDN with importmap:

```html
<script type="importmap">
  { "imports": { "@hot-labs/near-connect": "https://esm.sh/@hot-labs/near-connect" } }
</script>
<script type="module">
  import { NearConnector } from "@hot-labs/near-connect";
  // ...
</script>
```

## Quick Start

```typescript
import { NearConnector } from "@hot-labs/near-connect";

const connector = new NearConnector({
  network: "mainnet",
  walletConnect: {
    projectId: "your-project-id",
    metadata: {
      name: "My App",
      description: "My NEAR App",
      url: window.location.origin,
      icons: ["https://example.com/icon.png"]
    }
  }
});

connector.on("wallet:signIn", async (t) => {
  const wallet = await connector.wallet();
  const address = t.accounts[0].accountId;
});

connector.on("wallet:signOut", async () => {});

// Check if already signed in
try {
  const wallet = await connector.wallet();
  const accounts = await wallet.getAccounts();
  if (accounts.length > 0) {
    console.log("Already signed in:", accounts[0].accountId);
  }
} catch (e) {
  // Not signed in
}
```

## NearConnector Options

```typescript
interface NearConnectorOptions {
  network?: "mainnet" | "testnet";
  features?: Partial<WalletFeatures>;      // Filter wallets by features
  excludedWallets?: string[];              // Wallet IDs to exclude
  autoConnect?: boolean;                   // Default: true
  walletConnect?: { projectId: string; metadata: any };
  isBannedNearAddress?: (address: string) => Promise<boolean>;
  signIn?: { contractId?: string; methodNames?: string[] };  // Deprecated
}
```

## NearConnector Methods

```typescript
// Connect to wallet (shows selector popup if no ID provided)
await connector.connect(walletId?: string): Promise<NearWalletBase>

// Disconnect current wallet
await connector.disconnect(): Promise<void>

// Get current or specific wallet instance
await connector.wallet(id?: string): Promise<NearWalletBase>

// Show wallet selector popup
await connector.selectWallet(): Promise<string>

// Switch network (disconnects current wallet)
await connector.switchNetwork(network: "mainnet" | "testnet"): Promise<void>

// Get available wallets filtered by features
connector.availableWallets: NearWalletBase[]
```

## Events

```typescript
connector.on("wallet:signIn", ({ wallet, accounts, success }) => {});
connector.on("wallet:signOut", ({ success }) => {});
connector.on("selector:walletsChanged", () => {});

// Also: once(), off(), removeAllListeners()
```

## Wallet Interface

All wallets implement `NearWalletBase`:

```typescript
interface NearWalletBase {
  manifest: WalletManifest;

  signIn(data?: {
    network?: Network;
    contractId?: string;
    methodNames?: string[];
  }): Promise<Account[]>;

  signOut(data?: { network?: Network }): Promise<void>;

  getAccounts(data?: { network?: Network }): Promise<Account[]>;

  signAndSendTransaction(params: {
    signerId?: string;
    receiverId: string;
    actions: Action[];
    network?: Network;
  }): Promise<FinalExecutionOutcome>;

  signAndSendTransactions(params: {
    transactions: Transaction[];
    network?: Network;
  }): Promise<FinalExecutionOutcome[]>;

  signMessage(params: {
    message: string;
    recipient: string;
    nonce: Uint8Array;
    network?: Network;
  }): Promise<SignedMessage>;
}
```

## Types

```typescript
interface Account {
  accountId: string;
  publicKey: string;
}

interface SignedMessage {
  accountId: string;
  publicKey: string;
  signature: string;
}

type Network = "mainnet" | "testnet";
```

## Filter Wallets by Features

```typescript
const connector = new NearConnector({
  features: { signMessage: true, testnet: true }
});
```

Available features:
- `signMessage`
- `signTransaction`
- `signAndSendTransaction`
- `signAndSendTransactions`
- `signInWithoutAddKey`
- `testnet`
- `mainnet`

## Real-World Example: Sending a Transaction

```typescript
const connector = new NearConnector({ network: "mainnet" });

// Connect wallet (shows wallet selector popup)
await connector.connect();

// Get wallet and send transaction
const wallet = await connector.wallet();
const result = await wallet.signAndSendTransaction({
  receiverId: "contract.near",
  actions: [
    {
      type: "FunctionCall",
      params: {
        methodName: "ft_transfer",
        args: { receiver_id: "bob.near", amount: "1000000000000000000000000" },
        gas: "30000000000000",  // 30 TGas
        deposit: "1"            // 1 yoctoNEAR
      }
    }
  ]
});

console.log("Transaction hash:", result.transaction.hash);
```

## Supported Wallets

HOT Wallet, Meteor Wallet, Intear Wallet, MyNearWallet, Nightly Wallet, NEAR Mobile, Unity Wallet, OKX Wallet, and any wallet via WalletConnect.
